function e(){return e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},e.apply(this,arguments)}class t extends Error{constructor(e){super(e),this.name="SidechatAPIError"}}class r{constructor(r=""){var o=this;this.defaultHeaders={Accept:"application/json","Content-Type":"application/json"},this.setToken=e=>{this.userToken=e},this.loginViaSMS=async function(e){try{const t=await fetch("https://api.sidechat.lol/v1/login_register",{method:"POST",headers:o.defaultHeaders,body:JSON.stringify({phone_number:`+1${e}`,version:3})});return await t.json()}catch(e){throw console.error(e),new t("Failed to request SMS verification.")}},this.verifySMSCode=async function(e,r){try{var s;const t=await fetch("https://api.sidechat.lol/v1/verify_phone_number",{method:"POST",headers:o.defaultHeaders,body:JSON.stringify({phone_number:`+1${e}`,code:r.toUpperCase()})}),i=await t.json();return null!=i&&null!=(s=i.logged_in_user)&&s.token&&(o.userToken=i.logged_in_user.token),i}catch(e){throw console.error(e),new t("Failed verify this code.")}},this.setAge=async function(e,r){if(e<13)throw new t("You're too young to use Offsides.");try{const t=await fetch("https://api.sidechat.lol/v1/complete_registration",{method:"POST",headers:o.defaultHeaders,body:JSON.stringify({age:Number(e),registration_id:r})}),s=await t.json();return s.token&&(o.userToken=s.token),s}catch(e){throw console.error(e),new t("Failed verify this code.")}},this.registerEmail=async function(r){if(!o.userToken)throw new t("User is not authenticated.");try{const s=await fetch("https://api.sidechat.lol/v2/users/register_email",{method:"POST",headers:e({},o.defaultHeaders,{Authorization:`Bearer ${o.userToken}`}),body:JSON.stringify({email:r})}),i=await s.json();if(i.message)throw new t(i.message);return i}catch(e){throw console.error(error),new t("Failed to request email verification.")}},this.checkEmailVerification=async function(){if(!o.userToken)throw new t("User is not authenticated.");try{const r=await fetch("https://api.sidechat.lol/v1/users/check_email_verified",{method:"GET",headers:e({},o.defaultHeaders,{Authorization:`Bearer ${o.userToken}`})}),s=await r.json();if(s.verified_email_updates_response)return s.verified_email_updates_response;throw new t((null==s?void 0:s.message)||"Email is not verified.")}catch(e){throw console.error(error),new t("Email is not verified.")}},this.setDeviceID=async function(r){if(!o.userToken)throw new t("User is not authenticated.");try{const t=await fetch("https://api.sidechat.lol/v1/register_device_token",{method:"POST",headers:e({},o.defaultHeaders,{Authorization:`Bearer ${o.userToken}`}),body:JSON.stringify({build_type:"release",bundle_id:"com.flowerave.sidechat",device_token:r})}),s=await t.json();return await AsyncStorage.setItem("deviceID",r),s}catch(e){throw console.error(e),new t("Failed verify this code.")}},this.getUserAndGroup=async function(r=""){if(!o.userToken)throw new t("User is not authenticated.");try{const t=await fetch(`https://api.sidechat.lol/v1/updates?group_id=${r}`,{method:"GET",headers:e({},o.defaultHeaders,{Authorization:`Bearer ${o.userToken}`})});return await t.json()}catch(e){throw console.error(e),new t("Failed to get posts from group.")}},this.getGroupPosts=async function(r,s="hot",i){if(!o.userToken)throw new t("User is not authenticated.");try{const t=await fetch(`https://api.sidechat.lol/v1/posts?group_id=${r}&type=${s}${i?"&cursor="+i:""}`,{method:"GET",headers:e({},o.defaultHeaders,{Authorization:`Bearer ${o.userToken}`})});return await t.json()}catch(e){throw console.error(e),new t("Failed to get posts from group.")}},this.setVote=async function(r,s){if(!o.userToken)throw new t("User is not authenticated.");try{const t=await fetch("https://api.sidechat.lol/v1/posts/set_vote",{method:"POST",headers:e({},o.defaultHeaders,{Authorization:`Bearer ${o.userToken}`}),body:JSON.stringify({post_id:r,vote_status:s})});return await t.json()}catch(e){throw console.error(e),new t("Failed to change the vote on post.")}},this.getPostComments=async function(r){if(!o.userToken)throw new t("User is not authenticated.");try{const s=await fetch(`https://api.sidechat.lol/v1/posts/comments/?post_id=${r}`,{method:"GET",headers:e({},o.defaultHeaders,{Authorization:`Bearer ${o.userToken}`})});function i(e){const t=new Map,r=[];return e.forEach(e=>{t.set(e.id,e);const o=t.get(e.reply_post_id);o&&e.reply_post_id!==e.parent_post_id?(o.replies||(o.replies=[]),o.replies.push(e)):r.push(e)}),a(r)}function a(e){return e.reduce((e,t)=>(e.push(t),t.replies&&e.push(...a(t.replies)),e),[])}return i((await s.json()).posts)}catch(n){throw console.error(n),new t("Failed to get comments on post.")}},this.getAvailableGroups=async function(){if(!o.userToken)throw new t("User is not authenticated.");try{const t=await fetch("https://api.sidechat.lol/v1/groups/explore",{method:"GET",headers:e({},o.defaultHeaders,{Authorization:`Bearer ${o.userToken}`})}),r=await t.json();return await r.groups}catch(e){throw console.error(e),new t("Failed to get groups from explore.")}},r&&(this.userToken=r)}}export{r as SidechatAPIClient,t as SidechatAPIError};
//# sourceMappingURL=sidechat.modern.js.map
